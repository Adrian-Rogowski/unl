const tempImage=[],tempApiResponse={};unlayer.registerTool({name:"ai_image_tool",label:"Banner",icon:"https://d3vhsxl1pwzf0p.cloudfront.net/ai_image/banner.svg",supportedDisplayModes:["web","email"],position:4,options:{productContent:{title:"Image",position:1,options:{productImage:{label:"Image",defaultValue:{url:"https://d3vhsxl1pwzf0p.cloudfront.net/ai_image/h_1_7.jpg"},widget:"image"},productImageAlignment:{label:"Alignment",defaultValue:"center",widget:"alignment"},productImageHeadlines:{label:"Headlines",widget:"headlines"},productImageLibrary:{label:"Select Image from Library",widget:"product_image_library",defaultValue:[]},productImageAction:{label:"Image Action",defaultValue:{name:"web",values:{href:"http://google.com",target:"_blank"}},widget:"link"}}}},values:{containerPadding:"0px",baseImages:[]},transformer(e,t){let{name:a,value:d}=t;if(("productImage"===a||"src"===a)&&!e.productImageLibrary.includes(d.url)){let i={source:"edrone",tool:"aiImage",method:"uploadImage",value:{url:[d.url],id:e._meta.htmlID,images:e.productImageLibrary,headline:e.productImageHeadlines.headline,subHeadline:e.productImageHeadlines.subHeadline,firstUpload:"https://d3vhsxl1pwzf0p.cloudfront.net/ai_image/h_1_7.jpg"===e.productImage.url}};return window.parent.postMessage(i,"*"),setTimeout(()=>{let e=document.querySelector("#headline"),t=document.querySelector("#subHeadline"),a=document.querySelector("#regenerateImage");e.disabled=!0,t.disabled=!0,a.disabled=!0},1e3),{...e,productImageLibrary:[]}}if("productImageLibrary"===a){if(d.id===e._meta.htmlID){let r=document.querySelector("#headline"),l=document.querySelector("#subHeadline"),n=document.querySelector("#regenerateImage");return r&&l&&n&&(r.disabled=!1,l.disabled=!1,n.disabled=!1),tempImage.push(d.indexSelectedImage?d.data[d.indexSelectedImage]:d.data[1]||d.data[0]),{...e,productImage:{url:d.indexSelectedImage?d.data[d.indexSelectedImage]:d.data[1]||d.data[0]},productImageLibrary:d.data,productImageHeadlines:{headline:d.headline||e.productImageHeadlines.headline,subHeadline:d.subHeadline||e.productImageHeadlines.subHeadline},baseImages:d.baseImages}}return d.id?{...e,productImageLibrary:tempApiResponse[e._meta.htmlID]||e.productImageLibrary.data,productImage:e.productImage}:(updateSelectedImage(d.url),{...e,productImageLibrary:d.data,productImage:{url:d.url}})}if("productImageHeadlines"===a&&"regenerateImage"===d.method){let o=e.productImageLibrary.indexOf(e.productImage.url),g={source:"edrone",tool:"aiImage",method:"regenerateImage",value:{headline:d.headline,subHeadline:d.subHeadline,images:e.productImageLibrary,baseImages:e.baseImages&&e.baseImages.length>0?e.baseImages:e.context&&e.context.length>0?e.context:[e.productImageLibrary[0]],url:e.productImageLibrary,id:e._meta.htmlID,indexSelectedImage:o}};return window.parent.postMessage(g,"*"),{...e,productImageLibrary:[]}}return e},renderer:{Viewer:unlayer.createViewer({render(e){let t=e.productImageAlignment||"center";return 0===e.productImageLibrary.length?`
          <div style="display:flex;justify-content:${t}">
            <img style="display: block; max-width: ${e.productImage.maxWidth}; min-width: 100px; width: ${e.productImage.maxWidth}; filter: blur(8px)" src="${e.productImage.url}" >
              <div style="position: absolute;left: 50%;top: 50%;transform: translate(-50%, -50%);width: 90%;text-align: center;background: #ffffffd4;display: flex;flex-direction: column;justify-content: center;border-radius: 8px;padding: 8px;">
                <p style="margin:0;color:#050505;font-size:16px;font-weight:500">Making your image beautiful… ✨</p>
              </div>
            </img>
          </div>`:`
        <a style="display:flex;justify-content:${t}" href="${e.productImageAction.url}" target="${e.productImageAction.target}">
          <img style="display: block; max-width: ${e.productImage.maxWidth}; min-width: 100px; width: 100%;" src="${e.productImage.url}"  />
        </a>
        `}}),exporters:{web:function(e){let t=e.productImageAlignment||"center";return`<a style="display:flex;justify-content:${t}" href="${e.productImageAction.url}" target="${e.productImageAction.target}">
          <img style="display: block; max-width: ${e.productImage.maxWidth}; min-width: 100px; width: 100%;" src="${e.productImage.url}"  />
        </a>`},email:function(e){let t=e.productImageAlignment||"center";return`<a style="display:flex;justify-content:${t}" href="${e.productImageAction.url}" target="${e.productImageAction.target}">
          <img style="display: block; max-width: ${e.productImage.maxWidth}; min-width: 100px; width: 100%;" src="${e.productImage.url}"  />
        </a>`}},head:{css:function(){},js:function(e){tempImage.push(e.productImage.url)}}},validator:()=>[]});const productImageList='<div id="aiImagesList"  style="display:grid; grid-template-columns: 1fr 1fr 1fr; overflow:hidden; gap:8px"></div>';function updateSelectedImage(e){let t=document.querySelector("#aiImagesList");if(!t)return;let a=t.querySelectorAll("img");a.forEach(t=>{t.src===e?t.style.border="4px solid #006CFA":t.style.border="1px solid #E5E5E5"})}unlayer.registerPropertyEditor({name:"product_image_library",layout:"bottom",Widget:unlayer.createWidget({render:()=>'<div id="aiImagesList"  style="display:grid; grid-template-columns: 1fr 1fr 1fr; overflow:hidden; gap:8px"></div>',mount(e,t,a){let d=document.querySelector("#aiImagesList");0===t.length?(d.innerHTML=`
        <div style="text-align:center;">
          <p style="margin:0;color:#050505;font-size:16px;font-weight:500">Making your image beautiful… ✨</p>
        </div>
        `,d.style.display="flex",d.style.justifyContent="center",d.style.alignItems="center"):(d.innerHTML="",d.style.display="grid",d.style.gridTemplateColumns="1fr 1fr 1fr",t.forEach(e=>{let i=document.createElement("img");i.src=e,i.style.width="100%",i.style.height="auto",i.style.borderRadius="4px",i.style.border="1px solid #E5E5E5",i.onclick=function(){a({url:e,data:t})},d.appendChild(i)}),tempImage.forEach(e=>{t.includes(e)&&updateSelectedImage(e)})),window.addEventListener("message",function e(d){"edrone"===d.data.source&&"aiImage"===d.data.tool&&"regenerateImage"===d.data.method&&(tempApiResponse[d.data.id]=d.data.images,0===t.length&&a({url:d.data.indexSelectedImage?d.data.images[d.data.indexSelectedImage]:d.data.images[1],baseImages:d.data.baseImages,data:d.data.images,headline:d.data.headline,subHeadline:d.data.subHeadline,id:d.data.id,indexSelectedImage:d.data.indexSelectedImage}))})}})}),unlayer.registerPropertyEditor({name:"headlines",Widget:unlayer.createWidget({render:()=>`
      <div style="display:flex;gap:8px;margin-bottom:16px">
        <div style="width:50%;">
          <p style="color:#050505;font-size: 16px;font-weight: 400;margin:0">Heading</p>
          <input id="headline" maxlength="17" style="min-height: 40px;border:0;border-radius: 4px;background:#F2F2F2;padding: 4px 4px 4px 12px;width: 100%;" placeholder="Headline text" />
        </div>
        <div style="width:50%;">
          <p style="color:#050505;font-size: 16px;font-weight: 400;margin:0">Subheading</p>
          <input id="subHeadline" maxlength="23" style="min-height: 40px;border:0;border-radius: 4px;background:#F2F2F2;padding: 4px 4px 4px 12px;width: 100%;" placeholder="Sub-headline text"/>
        </div>
      </div>
      
      <button id="regenerateImage" style="width:100%;padding: 8px 16px;border-radius: 4px;border: 1px solid #E5E5E5;background: #FFF;">
      Change text
      </button>
      `,mount(e,t,a){let[d,i]=e.querySelectorAll("input"),r=e.querySelector("#regenerateImage");d.value=t.headline||"",i.value=t.subHeadline||"",d.oninput=function(){a({headline:d.value,subHeadline:i.value})},i.oninput=function(){a({headline:d.value,subHeadline:i.value})},r.onclick=function(){r.disabled=!0,d.disabled=!0,i.disabled=!0,a({headline:d.value,subHeadline:i.value,method:"regenerateImage",force:Math.random()})}}})});
